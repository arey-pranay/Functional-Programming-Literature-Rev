<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Factorial Calculation</title>
  <style>
    /* CSS styles for the stack container */
    .stack-container {
      width: 300px;
      height: 80vh;
      background-color: #f0f0f0;
      border: 2px solid #ccc;
      margin: 20px auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      overflow: hidden;
    }

    /* CSS styles for stack items */
    .stack-item {
      width: 80%;
      height: 40px;
      background-color: #3498db;
      margin: 5px 0;
      transition: transform 0.2s ease-in-out;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    /* CSS styles for the push and pop buttons */
    .stack-control {
      margin: 0 0;
      display: flex;
      gap: 10rem;
      justify-content: center;
    }

    .push-btn,
    .pop-btn {
      padding: 10px 20px;
      background-color: #db5534;
      color: white;
      border: none;
      cursor: pointer;
      transition: 500ms;
    }

    .push-btn:hover,
    .pop-btn:hover {
      opacity: 70%;
      transform: scale(1.2);
    }

    .push-btn:active,
    .pop-btn:active {
      opacity: 100%;
      transform: scale(0.5);
    }

    /* Keyframes for push animation */
    @keyframes pushAnimation {
      from {
        transform: translateY(-100%);
      }

      to {
        transform: translateY(0);
      }
    }
  </style>
</head>

<body>
  <h2 style="position: absolute; bottom: 0; left: 15%; margin-bottom: 2%;">Function Call Stack</h2>

  <div style="display: flex; align-items: center;">
    <div class="stack-container" id="stack">
      <!-- Stack items will be added and removed here -->
    </div>
    <div style="height: fit-content;" class="stack-control">
      <button class="push-btn" onclick="nextStep()">Next</button>
    </div>
    <div class="stack-container" id="stack2">
      <h2 style="position: absolute; bottom: 0; margin-bottom: 2%;">Return Value Stack</h2>
    </div>
  </div>


  <script>
    // Function to push a function call onto the stack
    let callStack = [];
    const num = 5;

    function pushFunctionCall(functionName, stackname) {
      const stack = document.getElementById(stackname);
      console.log(stackname);
      callStack.push(functionName);

      const newItem = document.createElement('div');
      newItem.classList.add('stack-item');
      newItem.textContent = functionName;
      stack.insertBefore(newItem, stack.firstChild);

      // Trigger animation
      setTimeout(() => {
        newItem.style.animation = 'pushAnimation 0.1s ease-in-out';
      }, 10);

      // Remove animation class after the animation completes
      newItem.addEventListener('animationend', () => {
        newItem.style.animation = '';
      });
    }

    // Function to pop the top function call from the stack
    function popFunctionCall() {
      const stack = document.getElementById('stack');
      if (callStack.length > 0) {
        callStack.pop();

        const items = stack.getElementsByClassName('stack-item');
        if (items.length > 0) {
          const poppedItem = items[0];
          poppedItem.style.transform = 'translateY(-100%)';
          setTimeout(() => {
            poppedItem.remove();
          }, 200);
        }
      }
    }

    // Recursive function to calculate factorial
    function calculateFactorial(n) {
      if (n === 0 || n === 1) {
        pushFunctionCall(`fact(${n}) = 1`, "stack");
      } else {
        pushFunctionCall(`fact(${n}) = ${n} * fact(${n - 1})`, "stack");
      }
    }

    currentStep = 0;


    // Function to progress to the next step
    flag = 0;
    facto = 1
    function nextStep() {
      if (flag === 1) {
        popFunctionCall();
        facto = facto * popstep;
        console.log(facto);
        pushFunctionCall(facto + " is returned", "stack2");
        popstep++;
        if (popstep !== num + 1) {
          popFunctionCall();
        }
        else {
          document.querySelector('.push-btn').style.display = "none";

        }


      }
      if (currentStep === 0) {
        resetStack();
        calculateFactorial(num);
      } else if (currentStep >= 1 && currentStep < num) {
        calculateFactorial(num - currentStep);
      } else if (currentStep === num && callStack.length > 0) {
        flag = 1;
        popstep = 1;
        console.log(popstep++)
        popFunctionCall();
        pushFunctionCall(1 + " is returned", "stack2");
        if (callStack.length === 0) {
          // Reset the current step when all elements are popped
          currentStep = 0;
        }
      }
      currentStep++;
    }



    // Function to reset the stack
    function resetStack() {
      callStack = [];
      const stack = document.getElementById('stack');
      stack.innerHTML = '';
      currentStep = 0;
    }
  </script>
</body>

</html>